function MproEntity(){function e(){var e="";a=new Array;for(var t in i)if("getAll"!==t&&"class"!==t&&"Save"!==t&&"cod"!==t&&"Delete"!==t&&"RefObject"!==t&&"function"!=typeof i[t])if(i[t]instanceof Array)o=!0,-1!==t.indexOf("Entity")&&a.push(t);else if(-1!==t.indexOf("Ref")){var n=i[t].cod;e+=("string"==typeof n?"'":"")+n+("string"==typeof n?"'":"")+", "}else-1!==t.indexOf("Crypt")&&-1===i[t].indexOf("{}")?(i[t]="{}"+CryptoJS.SHA1(i[t]),e+=("string"==typeof i[t]?"'":"")+i[t]+("string"==typeof i[t]?"'":"")+", "):e+=("string"==typeof i[t]?"'":"")+i[t]+("string"==typeof i[t]?"'":"")+", ";return e=e.replace(/, $/,"")}function t(){var e="";a=new Array;for(var t in i)if("getAll"!==t&&"class"!==t&&"Save"!==t&&"cod"!==t&&"Delete"!==t&&"RefObject"!==t&&"function"!=typeof i[t])if(i[t]instanceof Array)o=!0,-1!==t.indexOf("Entity")&&a.push(t);else if(-1!==t.indexOf("Ref")){var n=i[t].cod;e+=t+" = "+("string"==typeof n?"'":"")+n+("string"==typeof n?"'":"")+", "}else if(-1!==t.indexOf("Crypt")){var n=i[t];-1===n.indexOf("{}")&&(n="{}"+CryptoJS.SHA1(n)),e+=t+" = "+("string"==typeof n?"'":"")+n+("string"==typeof n?"'":"")+", "}else e+=t+" = "+("string"==typeof i[t]?"'":"")+i[t]+("string"==typeof i[t]?"'":"")+", ";return e=e.replace(/, $/,"")}function n(){if(MproEntity.canCreateTables){var e=(new Array,new MproEntity.CreateTable);if(""!==i["class"]){e.Name=i["class"];for(var t in i)"getAll"!==t&&"cod"!==t&&"class"!==t&&"Save"!==t&&"Delete"!==t&&"RefObject"!==t&&"function"!=typeof i[t]&&(i[t]instanceof Array||(e.Fields.push(t),e.Types.push("number"==typeof i[t]?"NUMERIC":"TEXT")));if(window.externalEnvironment)externalEnvironment.setDataJSONObject(JSON.stringify(e)),externalEnvironment.executeData();else{var n=new Ajax;n.Url=MproEntity.serverUrl+"/createTableService"+MproEntity.serverTech,n.setData({createTable:JSON.stringify(e),user:__projectUser__,cod:__projectCod__}),n.onSucces(function(){}),n.execute()}}}}function r(){for(var e in i)"getAll"!==e&&"class"!==e&&"Save"!==e&&"Delete"!==e&&"function"!=typeof i[e]&&"RefObject"!==e&&"function"!=typeof i[e]&&("string"==typeof i[e]?i[e]=null:"number"==typeof i[e]&&(i[e]=2147483647))}var i=this,o=!1,a=new Array;if(this.cod=2147483647,this.RefObject=null,this["class"]=this.constructor.name,void 0===window[this["class"]]["class"]){window[this["class"]]["class"]={};for(var s in i)"class"!==s&&"RefObject"!==s&&"function"!=typeof i[s]&&(window[this["class"]]["class"][s]={field:s,"class":this["class"]})}MproEntity.serverSeted||(MproEntity.serverUrl="server",MproEntity.serverTech=".php"),void 0===this["class"]&&(this["class"]=""),this.Delete=function(){var e=new MproEntity.DataReference;if(0===i.cod)return 0;i.RefObject?(e.Name=i["class"],e.Cod=i.cod,e.NameRef=i.RefObject["class"],e.CodRef=i.RefObject.cod):(e.Name=i["class"],e.Cod=i.cod);var t=$.extend(!0,[],a);if(window.externalEnvironment){if(externalEnvironment.setDataJSONObject(JSON.stringify(dataRecord)),externalEnvironment.executeData(),i.cod=2147483647,o)for(var n=0;n<t.length;n++)for(var r=i[t[n]],s=0;s<r.length;s++)r[s].Delete(t[n],i.cod)}else{var l=new Ajax;l.Url=MproEntity.serverUrl+"/dataRemoveService"+MproEntity.serverTech,l.setData({dataRemove:JSON.stringify(e),user:__projectUser__,cod:__projectCod__}),l.onSucces(function(){if(o)for(var e=0;e<t.length;e++)for(var n=i[t[e]],r=0;r<n.length;r++)n[r].Delete(t[e],i.cod)}),l.execute()}},this.Save=function(n,r,s){var l=!1,c=new MproEntity.DataRecord;c.Cod=i.cod,2147483647===i.cod?(c.Name=i["class"],c.Fields=e(),l=!0):(c.Name=i["class"],c.Fields=t());var f=$.extend(!0,[],a);if(window.externalEnvironment){if(externalEnvironment.setDataJSONObject(JSON.stringify(c)),l?i.cod=externalEnvironment.executeData():externalEnvironment.executeData(),n&&r){var v=new MproEntity.DataReference;v.Cod=i.cod,v.Name=i["class"],v.NameRef=n,v.Ix=s,v.CodRef=r,externalEnvironment.setDataJSONObject(JSON.stringify(v)),externalEnvironment.executeData()}if(o)for(var d=0;d<f.length;d++)for(var h=i[f[d]],u=0;u<h.length;u++)h[u].Save(i["class"],i.cod,f[d].match(/[0-9]+/)[0])}else{var p=new Ajax;p.Url=MproEntity.serverUrl+"/dataRecordService"+MproEntity.serverTech,p.setData({dataRecord:JSON.stringify(c),user:__projectUser__,cod:__projectCod__}),p.onSucces(function(e){if(l&&(i.cod=parseInt(e)),n&&r){var t=new MproEntity.DataReference;if(t.Cod=i.cod,t.Name=i["class"],t.NameRef=n,t.Ix=s,t.CodRef=r,window.externalEnvironment)window.externalEnvironment.Table();else{var a=new Ajax;a.Url=MproEntity.serverUrl+"/dataRecordService"+MproEntity.serverTech,a.setData({dataRecord:JSON.stringify(t),user:__projectUser__,cod:__projectCod__}),a.onSucces(function(){}),a.execute()}}if(o)for(var c=0;c<f.length;c++)for(var v=i[f[c]],d=0;d<v.length;d++)v[d].Save(i["class"],i.cod,f[c].match(/[0-9]+/)[0])}),p.execute()}},r(),n()}MproEntity.getWhere=function(e){if(!arguments.length<=1){var t=new e,n=new Array,r=new Array,i=new Array,o=!0,a=!0,s=new MproEntity.DataRequest;s.Name=t["class"];for(var l in t)t[l]instanceof Array?n.push(l.replace(/Entity[0-9]*/,"")):"getAll"!==l&&"cod"!==l&&"class"!==l&&"Save"!==l&&"Delete"!==l&&"RefObject"!==l&&"function"!=typeof t[l]&&(r.push(l),s.Fields.push(l));for(var c=1;c<arguments.length-1;c++)if("function"!=typeof arguments[c])if(c%2!==0){if(arguments[c]["class"]===t["class"])throw new Error("Ambiguos class search "+t["class"]+'. Instead, use the argument "where" of getAll.');s.NameRefs.push(arguments[c]["class"]),s.FieldsRefs.push(arguments[c].field)}else s.LogicVals.push(arguments[c].val),s.Comparators.push(arguments[c].comparator),s.LogicNexts.push(arguments[c].logicNext);if(s.LogicVals.length!==s.NameRefs.length)throw new Error("Number of Related Entities not match the number of Logical Operations.");if("function"!=typeof arguments[s.LogicVals.length+s.NameRefs.length+1])throw new Error("End Callback undefined.");if("function"!=typeof arguments[arguments.length-1]){var f=arguments[arguments.length-1];s.OrderBy+=" ORDER BY "+f.Classe["class"]+"."+f.Classe.field+" "+f.OrderBy}var v=arguments[s.LogicVals.length+s.NameRefs.length+1];if(window.externalEnvironment){for(var d=JSON.parse(externalEnvironment.query(s)),h=[],u=0;u<d.length;u++){h=[];var p=d[u],g=new e;g.cod=p[0];for(var c=0;c<r.length;c++)if(-1===r[c].indexOf("Ref"))g[r[c]]=p[c+1];else{h.push(r[c]);var y=!1;u>=d.length-1&&(y=!0);var E=function(e,t,n,r,i,o,a){return function(s){s&&(e[t[n]]=s[0]),r&&o&&h.length===a&&r(i)}};MproEntity.getAll(window[r[c].replace("Ref","")],E(g,r,c,v,i,y,h.length),"cod = "+p[c+1],void 0,1,void 0,!0,y)}if(n.length>0)for(var m=[],w=0;w<n.length;w++){var y=!1;void 0!==m[n[w]]?m[n[w]]+=1:m[n[w]]=1,w>=n.length-2&&u>=d.length-1&&(y=!0);var R=function(e,t,n,r,o,a){return function(s){for(var l=0;l<s.length;l++)s[l].RefObject=e;null!==s&&(e["Entity"+a+t[n]]=s,e[t[n+1]]=s),r&&o&&setTimeout(function(){r(i)},500)}};w%2===0&&MproEntity.getAll(window[n[w]],R(g,n,w,v,y,m[n[w]]),void 0,void 0,void 0,g,!0,void 0,m[n[w]])}i.push(g)}0===n.length&&0===h.length&&v(i,a),0===d.length&&v(i,a)}else{var x=new Ajax;x.Url=MproEntity.serverUrl+"/dataRequestService"+MproEntity.serverTech,x.setData({dataRequest:JSON.stringify(s),user:__projectUser__,cod:__projectCod__}),x.onSucces(function(t){for(var o=JSON.parse(t),s=[],l=0;l<o.length;l++){s=[];var c=o[l],f=new e;f.cod=c[0];for(var d=0;d<r.length;d++)if(-1===r[d].indexOf("Ref"))f[r[d]]=c[d+1];else{s.push(r[d]);var h=!1;l>=o.length-1&&(h=!0);var u=function(e,t,n,r,i,o,a){return function(l){l&&(e[t[n]]=l[0]),r&&o&&s.length===a&&r(i)}};MproEntity.getAll(window[r[d].replace("Ref","")],u(f,r,d,v,i,h,s.length),"cod = "+c[d+1],void 0,1,void 0,!0,h)}if(n.length>0)for(var p=[],g=0;g<n.length;g++){var h=!1;void 0!==p[n[g]]?p[n[g]]+=1:p[n[g]]=1,g>=n.length-2&&l>=o.length-1&&(h=!0);var y=function(e,t,n,r,o,a){return function(s){for(var l=0;l<s.length;l++)s[l].RefObject=e;null!==s&&(e["Entity"+a+t[n]]=s,e[t[n+1]]=s),r&&o&&setTimeout(function(){r(i)},500)}};g%2===0&&MproEntity.getAll(window[n[g]],y(f,n,g,v,h,p[n[g]]),void 0,void 0,void 0,f,!0,void 0,p[n[g]])}i.push(f)}0===n.length&&0===s.length&&v(i,a),0===o.length&&v(i,a)}),x.execute(o)}return i}return null},MproEntity.getAll=function(e,t,n,r,i,o,a,s,l){if(void 0===e)return null;void 0===n&&(n=""),(void 0===r||""===r)&&(r="cod asc"),void 0===a&&(a=!0),void 0===s&&(s=!0);var c=new e,f=new Array,v=new Array,d=new Array,h="";for(var u in c)c[u]instanceof Array?f.push(u.replace(/Entity[0-9]*/,"")):"getAll"!==u&&"cod"!==u&&"class"!==u&&"Save"!==u&&"Delete"!==u&&"RefObject"!==u&&"function"!=typeof c[u]&&v.push(u);var p=new MproEntity.DataRequest;if(p.Name=c["class"],p.Where=n,p.OrderBy=r,void 0!==o&&(p.NameRef=o["class"],p.CodRef=o.cod,void 0!==l&&(p.Ix=l)),i&&i.length&&2===i.length&&(p.Limiter[0]=i[0],p.Limiter[1]=i[1],h+=" LIMIT "+i[0]+", "+i[1]),window.externalEnvironment){for(var g=JSON.parse(externalEnvironment.query(p)),y=[],E=0;E<g.length;E++){y=[];var m=g[E],w=new e;w.cod=m[0];for(var R=0;R<v.length;R++)if(-1===v[R].indexOf("Ref"))w[v[R]]=m[R+1];else{y.push(v[R]);var x=!1;E>=g.length-1&&(x=!0);var O=function(e,t,n,r,i,o,a){return function(s){s&&(e[t[n]]=s[0]),r&&o&&y.length===a&&r(i)}};MproEntity.getAll(window[v[R].replace("Ref","")],O(w,v,R,t,d,x,y.length),"cod = "+m[R+1],void 0,1,void 0,!0,x)}if(f.length>0)for(var M=[],_=0;_<f.length;_++){var x=!1;void 0!==M[f[_]]?M[f[_]]+=1:M[f[_]]=1,_>=f.length-2&&E>=g.length-1&&(x=!0);var N=function(e,t,n,r,i,o){return function(a){for(var s=0;s<a.length;s++)a[s].RefObject=e;null!==a&&(e["Entity"+o+t[n]]=a,e[t[n+1]]=a),r&&i&&setTimeout(function(){r(d)},500)}};_%2===0&&MproEntity.getAll(window[f[_]],N(w,f,_,t,x,M[f[_]]),void 0,void 0,void 0,w,!0,void 0,M[f[_]])}d.push(w)}0===f.length&&0===y.length&&t(d,s),0===g.length&&t(d,s)}else{var S=new Ajax;S.Url=MproEntity.serverUrl+"/dataRequestAllService"+MproEntity.serverTech,S.setData({dataRequest:JSON.stringify(p),user:__projectUser__,cod:__projectCod__}),S.onSucces(function(n){for(var r=JSON.parse(n),i=[],o=0;o<r.length;o++){i=[];var a=r[o],l=new e;l.cod=a[0];for(var c=0;c<v.length;c++)if(-1===v[c].indexOf("Ref"))l[v[c]]=a[c+1];else{i.push(v[c]);var h=!1;o>=r.length-1&&(h=!0);var u=function(e,t,n,r,o,a,s){return function(l){l&&(e[t[n]]=l[0]),r&&a&&i.length===s&&r(o)}};MproEntity.getAll(window[v[c].replace("Ref","")],u(l,v,c,t,d,h,i.length),"cod = "+a[c+1],void 0,1,void 0,!0,h)}if(f.length>0)for(var p=[],g=0;g<f.length;g++){var h=!1;void 0!==p[f[g]]?p[f[g]]+=1:p[f[g]]=1,g>=f.length-2&&o>=r.length-1&&(h=!0);var y=function(e,t,n,r,i,o){return function(a){for(var s=0;s<a.length;s++)a[s].RefObject=e;null!==a&&(e["Entity"+o+t[n]]=a,e[t[n+1]]=a),r&&i&&setTimeout(function(){r(d)},500)}};g%2===0&&MproEntity.getAll(window[f[g]],y(l,f,g,t,h,p[f[g]]),void 0,void 0,void 0,l,!0,void 0,p[f[g]])}d.push(l)}0===f.length&&0===i.length&&t(d,s),0===r.length&&t(d,s)}),S.execute(a)}return d},MproEntity.serverUrl="",MproEntity.serverTech="",MproEntity.serverSeted=!1,MproEntity.canCreateTables=!0,MproEntity.setServer=function(e,t){window.externalEnvironment=void 0,MproEntity.serverUrl=e,MproEntity.serverTech=void 0==t?"":"."+t,MproEntity.serverSeted=!0},MproEntity.Logic=function(e,t,n){this.val=e,this.comparator=t,this.logicNext=n},MproEntity.Order=function(e,t){this.Classe=e,this.OrderBy=t},MproEntity.DataRecord=function(){this.Name="",this.Cod=2147483647,this.Fields=[],this.Data=[]},MproEntity.DataReference=function(){this.NameRef="",this.Name="",this.Ix=2147483647,this.CodRef=2147483647,this.Cod=2147483647},MproEntity.DataRequest=function(){this.Name="",this.Where="",this.OrderBy="",this.Ix=2147483647,this.NameRef="",this.CodRef=2147483647,this.Limiter=[],this.NameRefs=[],this.FieldsRefs=[],this.LogicVals=[],this.Comparators=[],this.LogicNexts=[],this.Fields=[]},MproEntity.CreateTable=function(){this.Name="",this.Fields=[],this.Types=[]},MproEntity.GT=" > ",MproEntity.GTE=" >= ",MproEntity.LT=" < ",MproEntity.LTE=" <= ",MproEntity.LIKE=" LIKE ",MproEntity.EQUAL=" = ",MproEntity.AND=" AND ",MproEntity.OR=" OR ",__projectUser__=0,__projectCod__=0;